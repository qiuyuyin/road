## Goç¼–è¯‘åŸç†

### ç¼–è¯‘å‰ç«¯å’Œç¼–è¯‘åç«¯

å…¶å®åœ¨ç¼–ç¨‹è¯­è¨€çš„ä½“ç³»ä¸­åŸºæœ¬éƒ½å­˜åœ¨è¿™æ ·çš„ä¸€ä¸ªè¿‡ç¨‹ï¼š

ç”±**ç¼–è¯‘å‰ç«¯**ç”Ÿæˆä¸­é—´ä»£ç ï¼Œç„¶åä½¿ç”¨**ç¼–è¯‘åç«¯**å¯¹ä¸­é—´ä»£ç åœ¨è¿è¡Œæ—¶è¿›è¡Œä¼˜åŒ–ã€‚

å­¦ä¹ è¿‡Javaçš„åŒå­¦åº”è¯¥éƒ½çŸ¥é“ï¼ŒJavaè¯­è¨€ä¼šé€šè¿‡javacç”Ÿæˆä¸ºclassæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨JVMè™šæ‹Ÿæœºè¿è¡Œclassæ–‡ä»¶ã€‚javacçš„è¿‡ç¨‹æ˜¯å…ˆè¿›è¡Œè¯æ³•å’Œè¯­æ³•çš„åˆ†æï¼Œç„¶åä½¿ç”¨ç¬¦å·è¡¨æ”¶é›†å˜é‡ã€ç±»å‹ç­‰å®šä¹‰ä¿¡æ¯ï¼Œè¿˜è¦å¯¹æ³¨è§£è¿›è¡Œè§£æï¼Œè¿›è¡Œè¯­ä¹‰åˆ†æï¼ˆå°†ä¸€äº›è¯­æ³•ç³–ã€é‡è½½ã€å˜é‡ç±»å‹ç­‰è¿›è¡Œè½¬åŒ–ï¼‰ï¼Œæœ€åå°†å­—èŠ‚ç ä¹Ÿå°±æ˜¯classæ–‡ä»¶è¿›è¡Œè¾“å‡ºã€‚

Goè¯­è¨€çš„ç¼–è¯‘è¿‡ç¨‹åŒæ ·æ˜¯ä½¿ç”¨è¿™ä¸€ç³»åˆ—æ­¥éª¤è¿›è¡Œæ“ä½œï¼Œä¸è¿‡è¿˜æ˜¯ä¼šç•¥æœ‰ä¸åŒã€‚

### ç¼–è¯‘è¿‡ç¨‹

> æ¯ä¸€ç§ç¼–ç¨‹è¯­è¨€éƒ½éœ€è¦å¯¹æºæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œç„¶åå°†æºä»£ç ç¼–è¯‘æˆæœºå™¨èƒ½å¤Ÿè¯»æ‡‚çš„è¯­è¨€ã€‚ä½†æ˜¯è¿™ä¸ªç¼–è¯‘è¿‡ç¨‹ä¸æ˜¯ä¸€è¹´è€Œå°±çš„ï¼Œæ˜¯éœ€è¦è¿›è¡Œå±‚å±‚è½¬åŒ–ï¼Œæ‰å¯ä»¥å°†æºç ç¼–è¯‘æˆåŠŸã€‚

è€ŒGoè¯­è¨€çš„ç¼–è¯‘è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼š

- è¯æ³•-è¯­æ³•è§£æ
- ç±»å‹æ£€æŸ¥å’ŒASTè½¬æ¢
- é€šç”¨SSAç”Ÿæˆ
- æœºå™¨ç ç”Ÿæˆ

### 1.è¯æ³•å’Œè¯­æ³•è§£æ

#### è¯æ³•åˆ†æ

Goä¸­è¿›è¡Œè¯æ³•åˆ†æï¼Œæ˜¯é€šè¿‡æºæ–‡ä»¶ä¸­çš„scanner.goæ–‡ä»¶ä¸­çš„ç»“æ„ä½“æ¥è¿›è¡Œå®ç°çš„ï¼š

```go
type scanner struct {
   source
   mode   uint
   nlsemi bool // if set '\n' and EOF translate to ';'

   // current token, valid after calling next()
   line, col uint
   blank     bool // line is blank up to col
   tok       token
   lit       string   // valid if tok is _Name, _Literal, or _Semi ("semicolon", "newline", or "EOF"); may be malformed if bad is true
   bad       bool     // valid if tok is _Literal, true if a syntax error occurred, lit may be malformed
   kind      LitKind  // valid if tok is _Literal
   op        Operator // valid if tok is _Operator, _AssignOp, or _IncOp
   prec      int      // valid if tok is _Operator, _AssignOp, or _IncOp
}
```

å¯ä»¥çœ‹è§è¿™ä¸ªç»“æ„ä½“ä¸­å­˜åœ¨ï¼Œæ–‡ä»¶çš„æºæ–‡ä»¶ã€è¡Œæ•°å’Œåˆ—æ•°ï¼Œä»¥åŠæ‰«æåˆ°çš„tokenå’Œå¯ç”¨çš„æ¨¡å¼

Tokençš„ç±»å‹å­˜åœ¨å¾ˆå¤šç§ï¼ŒåŒ…æ‹¬æ“ä½œç¬¦ï¼Œæ‹¬å·ï¼Œå…³é”®å­—ï¼Œå˜é‡åç­‰ï¼š

```go
const (
   _    token = iota
   _EOF       // EOF

   // names and literals
   _Name    // name
   _Literal // literal

   // operators and operations
   // _Operator is excluding '*' (_Star)
   _Operator // op
   _AssignOp // op=
   _IncOp    // opop
   _Assign   // =
   _Define   // :=
   _Arrow    // <-
   _Star     // *

   // delimiters
   _Lparen    // (
   _Lbrack    // [
   _Lbrace    // {
   _Rparen    // )
   _Rbrack    // ]
   _Rbrace    // }
   _Comma     // ,
   _Semi      // ;
   _Colon     // :
   _Dot       // .
   _DotDotDot // ...

   // keywords
   _Break       // break
   _Case        // case
   _Chan        // chan
   _Const       // const
   _Continue    // continue
   _Default     // default
   _Defer       // defer
   _Else        // else
   _Fallthrough // fallthrough
   _For         // for
   _Func        // func
   _Go          // go
   _Goto        // goto
   _If          // if
   _Import      // import
   _Interface   // interface
   _Map         // map
   _Package     // package
   _Range       // range
   _Return      // return
   _Select      // select
   _Struct      // struct
   _Switch      // switch
   _Type        // type
   _Var         // var

   // empty line comment to exclude it from .String
   tokenCount //
)
```

æœ€å¼€å§‹çš„goè¯­è¨€å¯èƒ½ä½¿ç”¨çš„æ˜¯lexæ¥è¿›è¡Œè¯æ³•è§£æï¼Œä½†æ˜¯éšç€goè¯­è¨€çš„å‘å±•ï¼Œç°åœ¨çš„å½¢æ€æ˜¯é€šè¿‡è‡ªå·±çš„è¯­è¨€æ¥å¯¹è‡ªå·±è¿›è¡Œè§£æã€‚å½“ç„¶cmdåŒ…ä¸‹çš„å†…å®¹ä¸€å®šæ˜¯æå‰å°±è¢«è§£æè¿‡äº†ï¼Œä¸ç„¶ä¹Ÿä¸å¯èƒ½ä½¿ç”¨è‡ªå·±æ¥å¯¹è‡ªå·±è¿›è¡Œè§£æã€‚

å¯èƒ½è¯æ³•è§£æçš„è¿‡ç¨‹æœ‰äº›æ™¦æ¶©ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯ï¼š

é€šè¿‡å†…ç½®è§£æå‡½æ•°å°†æºæ–‡ä»¶è§£æä¸ºtokenæ ¼å¼çš„ç»“æ„ä½“ã€‚

#### è¯­æ³•è§£æ

è¯­æ³•è§£æçš„è¿‡ç¨‹æ˜¯åŸºäºè¯æ³•è§£ææ¥è¿›è¡Œçš„ï¼Œæ‰€ä»¥è¿›è¡Œè¯­æ³•è§£æçš„ä¹Ÿå°±æ˜¯å¯¹è¯æ³•è§£æç”Ÿæˆçš„tokenåºåˆ—æ¥è¿›è¡Œè§£æã€‚

ç”±äºè¿™ä¸ªçš„è¿‡ç¨‹éå¸¸æ™¦æ¶©ï¼Œåˆæœ‰ç‰¹åˆ«å¤šçš„ä¸“ä¸šåè¯ï¼Œè¿˜æ²¡å­¦ä¹ è¿‡ç¼–è¯‘åŸç†çš„æˆ‘è§‰å¾—ååˆ†ç—›è‹¦ã€‚ğŸ˜­ç‰¹åˆ«æ˜¯å­˜åœ¨ä¸¤ç§è§£æçš„æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯æ–‡æ³•å’Œåˆ†ææ–¹æ³•ã€‚

æ–‡æ³•ä¸­å®šä¹‰äº†å¸¸é‡ã€å˜é‡ã€ç±»å‹ã€å‡½æ•°å’Œæ–¹æ³•çš„è¯­æ³•ç»“æ„ã€‚

åˆ†ææ–¹æ³•åˆ†ä¸ºè‡ªåº•å‘ä¸Šå’Œè‡ªé¡¶å‘ä¸‹ä¸¤ç§æ–¹å¼ï¼š

LL(1)ä¸ºè‡ªé¡¶å‘ä¸Šä¸‹LR(0), LR(1), SLR(1), LALR(1)ä¸ºè‡ªåº•å‘ä¸Šçš„æ–‡æ³•ï¼ˆå…·ä½“è¿‡ç¨‹è¯·ä¸¥æ ¼å‚è€ƒç¼–è¯‘åŸç†è¯¾ç¨‹æ‰€è®²è¿°çš„å†…å®¹ï¼‰

è€ŒGoè¯­è¨€ä½¿ç”¨çš„æ˜¯å¤šæ•°ç¼–ç¨‹è¯­è¨€æ‰€ä½¿ç”¨çš„LALR(1)æ¥å¯¹è¯­æ³•è¿›è¡Œè§£æï¼Œä½¿ç”¨æœ€å³æ¨å¯¼åŠ å‘å‰æŸ¥çœ‹æ¥å¯¹è¯­è¨€è¿›è¡Œè§£æã€‚

### 2.ç±»å‹æ£€æŸ¥

ä½¿ç”¨è¿‡Pythonå’ŒJsçš„åŒå­¦åº”è¯¥ä¼šæ˜ç™½è¿è¡Œæ—¶è¯­è¨€çš„ç—›è‹¦ï¼Œæ¯æ¬¡åªæœ‰åœ¨è¿è¡Œåœ¨ä¸€ä¸ªåœ°æ–¹æ‰ä¼šæ˜ç™½è¿™ä¸ªç¨‹åºæ˜¯æœ‰é—®é¢˜çš„ã€‚æ‰€ä»¥å¾®è½¯å¼€æºäº†Typescriptæ¥è§£å†³jsä½œä¸ºå¼±ç±»å‹çš„ä¸€äº›ç—›ç‚¹ï¼Œä½¿å…¶æ›´é€‚åˆä¼ä¸šçº§å¼€å‘ï¼ŒPythonä¹Ÿæœ‰ä¸€äº›å·¥å…·ä»¥ä¾¿äºåœ¨è¿è¡Œæ—¶å°±å‘ç°ä¸€äº›é—®é¢˜ã€‚

Goè¯­è¨€åŒæ ·ä½œä¸ºä¸€ä¸ªå¼ºç±»å‹çš„è¯­è¨€ï¼Œä¼šåœ¨ç¼–è¯‘é˜¶æ®µå¯¹æ¯ä¸ªå˜é‡è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œä½†æ˜¯ç”±äºGoä¸­å­˜åœ¨ä¸€ä¸ªæ¥å£interfaceå¯ä»¥è½¬è½½ä»»æ„ç±»å‹çš„å˜é‡ï¼Œåœ¨å¯¹interfaceè¿›è¡Œè½¬åŒ–çš„è¿‡ç¨‹ä¸­ååˆ†å®¹æ˜“å‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™éœ€è¦è¿›è¡ŒåŠ¨æ€ç±»å‹æ£€æŸ¥ï¼Œå¦‚æœæ— æ³•è¿›è¡Œè½¬åŒ–åˆ™ç¨‹åºä¼šå‡ºç°å´©æºƒã€‚

é€šè¿‡è¯æ³•å’Œè¯­æ³•è§£æä¼šç”Ÿæˆä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ï¼Œåœ¨ç±»å‹æ£€æŸ¥çš„æ—¶å€™ä¼šéå†æŠ½è±¡è¯­æ³•æ ‘ä¸­çš„èŠ‚ç‚¹ï¼Œå¯¹æ¯ä¸ªèŠ‚ç‚¹çš„ç±»å‹è¿›è¡Œæ£€éªŒï¼Œå¦‚æœå…¶ä¸­å‡ºç°è¯­æ³•é”™è¯¯ä¼šç›´æ¥æŠ›å‡ºç¼–è¯‘å™¨å¼‚å¸¸ï¼ŒåŒæ—¶å»é™¤ä¸€äº›ä¸ä¼šè¢«æ‰§è¡Œçš„ä»£ç è¡Œï¼Œå‡å°‘è¿è¡Œæ—¶æœŸçš„å·¥ä½œé‡ï¼ŒåŒæ—¶ä¹Ÿä¼šä¿®æ”¹makeå’Œnewçš„æ“ä½œã€‚

ä¸»è¦å¯¹åˆ‡ç‰‡ã€å“ˆå¸Œã€å…³é”®å­—è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œå°†å…¶è½¬åŒ–ä¸ºç›¸åº”çš„ç»“æ„ï¼Œåœ¨ä¹‹åæ›´æ˜“äºå¤„ç†ã€‚

### 3.ä¸­é—´ä»£ç ç”Ÿæˆ

è¿™ä¸ªä¸­é—´ä»£ç å°±æ˜¯ç±»ä¼¼Javaä¸­çš„classæ–‡ä»¶ï¼Œæ˜¯ç¼–è¯‘å™¨æˆ–è€…è™šæ‹Ÿæœºæ‰€ä½¿ç”¨çš„è¯­è¨€ï¼Œæˆ‘ä»¬å°†å®ƒå‘½åä¸ºä¸­é—´ä»£ç ã€‚

è€ŒGoè¯­è¨€çš„ä¸­é—´ä»£ç æ˜¯åŸºäºSSAåŒ…ä¸­çš„ä»£ç è¿›è¡Œæ„å»ºçš„ï¼Œç”±äºæ²¡æœ‰æ·±å…¥äº†è§£æºç ï¼Œæ‰€ä»¥å¯¹è¿™ä¸ªè¿‡ç¨‹ä¸æ˜¯å¤ªäº†è§£ã€‚ç¼–è¯‘å™¨ç”Ÿæˆä¸­é—´ä»£ç æ˜¯æˆ‘ä»¬ä¸­å›½ç¨‹åºå‘˜æ‰€ååˆ†æ¬ ç¼ºçš„ä¸€ä¸ªç†è®ºçŸ¥è¯†ã€‚å› ä¸ºæˆ‘ä»¬å¹¶æ²¡æœ‰å¤ªå¤šçš„ç ”ç©¶äººå‘˜æŠ•å…¥åˆ°ç¼–ç¨‹è¯­è¨€æ–¹é¢çš„ç ”ç©¶ï¼Œç”šè‡³æˆ‘ä»¬å›½å®¶å”¯ä¸€é«˜å¯ç”¨çš„æ“ä½œé¸¿è’™éƒ½æ˜¯ä½¿ç”¨çš„Cå’ŒJavaè¿›è¡Œå¼€å‘ï¼Œå¯¼è‡´å¯èƒ½ä¸€å¤§éƒ¨åˆ†åœ¨äº’è”ç½‘å·¥ä½œçš„èŒå‘˜å¯¹æ‰€ä½¿ç”¨è¯­è¨€çš„ç¼–è¯‘è¿‡ç¨‹å¹¶ä¸æ˜¯å¤ªè¿‡äº†è§£ï¼Œå°±ç®—äº†è§£ä¹Ÿå¯èƒ½åªæ˜¯ä¸ºäº†å‡†å¤‡é¢è¯•ï¼Œä¸ä¼šå½¢æˆè‡ªå·±çš„è§‚ç‚¹ã€‚

Goè¯­è¨€çš„ä¸­é—´ä»£ç ç”Ÿæˆè¿œè¿œä¸æ˜¯æ•°åè¡Œæ–‡å­—å°±å¯ä»¥è§£é‡Šæ¸…æ¥šçš„ï¼Œå› ä¸ºè¿™æ ·çš„ä¸€ä¸ªè¿‡ç¨‹å¯èƒ½æ˜¯æ— æ•°å¤§ç‰›ç§¯å¹´ç´¯æœˆçš„ä¼˜åŒ–æ‰å¯èƒ½è®©è¿™æ ·çš„ä¸€ä¸ªè¯­è¨€æˆä¸ºé«˜å¯ç”¨çš„ç¼–ç¨‹ç³»ç»Ÿï¼Œè®©æˆåƒä¸Šä¸‡çš„å•†ç”¨è½¯ä»¶å¾—ä»¥ç¨³å®šè¿è¡Œã€‚æ‰€ä»¥æˆ‘ä¹Ÿåªèƒ½å¯¹è¿™æ ·çš„ä¸€ä¸ªè¿‡ç¨‹è¿›è¡Œç®€è¦çš„æ¦‚è¿°ï¼Œå…·ä½“çš„ç»†èŠ‚è¿˜æ˜¯è¦å‚è€ƒinternalåŒ…ä¸­æ‰€ä½¿ç”¨çš„æºç ã€‚

![image-20220112204352570](https://yili979.oss-cn-beijing.aliyuncs.com/img/202201122044677.png)

å¦‚æœä½ æƒ³æŸ¥çœ‹ASSä»£ç ç”Ÿæˆçš„è¿‡ç¨‹ï¼Œåœ¨Linuxç³»ç»Ÿä¸­æˆ–è€…Macç³»ç»Ÿä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š

```sh
 GOSSAFUNC=hello go build hello.go
```

å¯ä»¥å¾—åˆ°ä¸€ä¸ªå…³äºSSAæ‰§è¡Œè¿‡ç¨‹çš„Htmlè¿‡ç¨‹ï¼Œå¯ä»¥æŸ¥çœ‹SSAç¼–è¯‘å™¨æ˜¯å¦‚ä½•é€šè¿‡ä¸€ç³»åˆ—çš„è¿‡ç¨‹å°†sourceæºç è½¬åŒ–ä¸ºSSAç±»å‹çš„æ–‡ä»¶çš„ã€‚

### 4.æœºå™¨ç çš„ç”Ÿæˆ

ä¸‹å›¾ä¸ºCè¯­è¨€æ‰§è¡Œçš„è¿‡ç¨‹ï¼š

![C_complie](https://yili979.oss-cn-beijing.aliyuncs.com/img/202201122134673.png)

ç›¸åŒçš„æ˜¯ï¼Œåœ¨Goè¯­è¨€ä¸­ä¹Ÿæ˜¯éœ€è¦å…ˆå°†ä¸­é—´ä»£ç SSAè½¬åŒ–ä¸ºæ±‡ç¼–ä»£ç ï¼Œç„¶åå°†æ±‡ç¼–ä»£ç é€šè¿‡æ±‡ç¼–å™¨è½¬æ¢ä¸ºæœºå™¨ç ã€‚

æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯åœ¨Goæºç åŒ…ä¸­ï¼Œå¯¹äºä¸åŒæŒ‡ä»¤é›†ä¼šå­˜åœ¨ä¸åŒçš„æ–¹å¼æ¥è¿›è¡Œç¼–è¯‘ã€‚

å¯ä»¥çœ‹è§å¯¹äºä¸åŒçš„æŒ‡ä»¤é›†å­˜åœ¨ä¸åŒçš„æ–¹å¼æ¥è¿›è¡Œè½¬åŒ–ï¼Œå°†æ±‡ç¼–è¯­æ³•æ¥ä½¿ç”¨ä¸åŒçš„æ±‡ç¼–å™¨ï¼Œä»¥ä¾¿äºåœ¨ä¸åŒçš„æœºå™¨ä¸Šè·‘ä¸€å¥—æºç ï¼Œå®ç°äº†å…¨å¹³å°è¿è¡Œçš„æ€§è´¨ã€‚

![image-20220112213858768](https://yili979.oss-cn-beijing.aliyuncs.com/img/202201122138728.png)

### æ€»ç»“

åœ¨å­¦ä¹ Goè¯­è¨€ç¼–è¯‘åŸç†è¿™ä¸€éƒ¨åˆ†æ—¶ï¼Œç”±äºè¿˜æ²¡æœ‰å­¦ä¹ è¿‡ç¼–è¯‘åŸç†è¿™é—¨è¯¾ç¨‹ï¼Œæ‰€ä»¥å¯¹æœ‰äº›ç¼–è¯‘è¿‡ç¨‹çš„è¿‡ç¨‹ä¸æ˜¯å¤ªäº†è§£ã€‚ä½†æ˜¯å½“çœŸæ­£æ·±å…¥äº†è§£è¿™ä¸ªç¼–è¯‘è¿‡ç¨‹æ—¶ï¼Œæ‰å‘ç°è¿™éƒ¨åˆ†çŸ¥è¯†æ ¹æœ¬ä¸æ˜¯ä¸€å¤©ä¸¤å¤©å°±èƒ½ç²¾é€šçš„ï¼Œæ‰€ä»¥å¯¹Goè¯­è¨€çš„ç¼–è¯‘è¿‡ç¨‹ä¹Ÿåªæ˜¯æµ…å°è¾„æ­¢ï¼Œä»…ä»…äº†è§£äº†ä¸€äº›çš®æ¯›ï¼Œä½†è¿˜æ˜¯æ”¶è·æ»¡æ»¡ã€‚

ä»è¯æ³•å’Œè¯­æ³•è§£æå°†æºä»£ç è½¬åŒ–ä¸ºè¯­æ³•æ ‘ï¼Œç„¶åä½¿ç”¨ç±»å‹æ£€æŸ¥æ¥ç²¾ç®€å’ŒéªŒè¯è¯­æ³•æ ‘ï¼Œå†ä½¿ç”¨SAAåŒ…æ¥å°†è¯­æ³•æ ‘è½¬ä¸ºä¸­é—´ä»£ç ï¼Œæœ€åä½¿ç”¨OBJåŒ…ä¸­çš„å†…å®¹å°†ä¸­é—´ä»£ç è½¬ä¸ºå¯ä»¥å†ä¸åŒå¹³å°è¿›è¡Œæ‰§è¡Œçš„æœºå™¨è¯­è¨€ã€‚